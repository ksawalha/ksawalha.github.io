<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic School Survey</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=Urbanist:wght@500;600&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Urbanist', 'Tajawal', sans-serif;
        }
        body {
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%; /* Ensure full viewport height */
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full height of the viewport */
            width: 100%;
            max-width: 100%;
        }

        .logo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 10%; /* 15% of the viewport height */
            padding: 10px;
        }

        .logo {
            width: 80px;
        }

        .loading {
            display: flex;               /* Use flex layout */
            flex-direction: row;         /* Arrange items in a row */
            justify-content: center;     /* Center items horizontally */
            align-items: center;         /* Center items vertically */
            flex-wrap: nowrap;           /* Prevent wrapping to multiple rows */
            width: auto;                 /* Allow width to auto-adjust based on content */
            max-width: 100%;             /* Prevent it from growing beyond container */
        }

        .loader-img {
            width: 30px; 
            height: 30px; 
            margin-right: 10px; 
        }

        h3 {
            margin: 0; 
            font-size: 0.8rem;
            color: #555;
            font-weight: bold;
        }

        .image-container {
            background-image: url('https://raw.githubusercontent.com/ksawalha/ksawalha.github.io/e568e22457e2b74ec487aa2059478479697b3e6b/loginbackground.jpg');
            background-size: cover;
            background-position: center;
            height: 67%; /* 67% of the viewport height */
            border-radius: 15px;
            margin: 0 10px;
        }

        .content {
            height: 17%; /* 17% of the viewport height */
            padding: 10px;
            overflow-y: auto;
        }

        .title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #444;
            text-align: left;
            margin-bottom: 10px;
        }

        .description {
            font-size: 1rem;
            color: #777;
            line-height: 1.6;
            text-align: justify;
            margin-top: 10px;
            word-wrap: break-word;
            word-break: break-word;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 1.2rem;
            }

            .description {
                font-size: 0.9rem;
            }

            .logo-container {
                padding: 10px;
            }
        }
    </style>
    <script>
function openAppOrStore(appScheme, appStoreURL, playStoreURL, hold) {
    if (hold === "1") {
        document.getElementById('loading').style.display = 'block';
        return;
    }

    var platform = detectPlatform();
    var retries = 3; // Number of retries
    var retryInterval = 1000; // 1 second interval between retries
    var attemptCount = 0;

    var openApp = function() {
        window.location = appScheme;
        attemptCount++;

        if (attemptCount >= retries) {
            // After retries, redirect to store if the app didn't open
            redirectToStore(platform, appStoreURL, playStoreURL);
        } else {
            // Retry after a delay
            setTimeout(openApp, retryInterval);
        }
    };

    openApp(); // Start the first attempt

    // Set timeout to redirect to store if no app is opened after all attempts
    var fallbackTimer = setTimeout(function() {
        if (attemptCount < retries) {
            redirectToStore(platform, appStoreURL, playStoreURL);
        }
    }, retries * retryInterval + 1500); // Total wait time (retries + additional buffer)

    // Detect app opening
    var visibilityHandler = function() {
        if (document.visibilityState === 'hidden') {
            clearTimeout(fallbackTimer); // Cancel the fallback if the app opened successfully
            window.removeEventListener('visibilitychange', visibilityHandler); // Remove the listener
        }
    };
    window.addEventListener('visibilitychange', visibilityHandler);
}

function redirectToStore(platform, appStoreURL, playStoreURL) {
    if (platform === "iOS") {
        window.location.href = appStoreURL;  // Redirect to App Store for iOS
    } else if (platform === "Android") {
        window.location.href = playStoreURL;  // Redirect to Play Store for Android
    } else {
        alert("Unsupported platform.");
    }
}

function detectPlatform() {
    var userAgent = navigator.userAgent || navigator.vendor || window.opera;

    // iOS device check
    if (/iPhone|iPad|iPod/i.test(userAgent)) {
        return "iOS";
    }
    // Android device check
    if (/android/i.test(userAgent)) {
        return "Android";
    }

    return "Unknown";  // Default to unknown if neither iOS nor Android
}
    </script>
</head>
<body>
    <div class="container">
        <!-- Logo and Loading -->
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/ksawalha/ksawalha.github.io/e568e22457e2b74ec487aa2059478479697b3e6b/staticlogo.png" alt="School Logo" class="logo">
            <div id="loading" class="loading">
                <img src="https://raw.githubusercontent.com/ksawalha/ksawalha.github.io/refs/heads/main/Rolling.svg" alt="Loading..." class="loader-img">
                <h3>Redirecting</h3>
            </div>
        </div>

        <!-- Header Image -->
        <div class="image-container"></div>

        <!-- Content -->
        <div class="content">
            <h1 class="title">Arabic School for Parents</h1>
            <p class="description">
                This page will attempt to open your app or redirect you to the app store to install the app if not found.
            </p>
        </div>
    </div>
</body>
</html>
